name: gh-pages
on:
    workflow_dispatch:
    push:
jobs:
    build:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4.0.0
            - name: UV
              uses: astral-sh/setup-uv@v5
              with:
                  enable-cache: true
                  cache-dependency-glob: "uv.lock"
            - name: Build
              run: uv run flet build web -v --skip-flutter-doctor
    deploy-resume:
        # needs: build
        # if: success()
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4.0.0
            - name: Fetch main
              run: |
                  git config --global user.name "GitHub Actions"
                  git config --global user.email "actions@github.com"
                  git fetch
            - name: Download Resume
              uses: robinraju/release-downloader@v1.12
              with:
                  latest: true
                  fileName: "resume.pdf"
                  out-file-path: "data/docs/"
                  repository: "MH0386/MH0386"
            - name: Commit and Push Resume
              run: |
                  git add data/docs/
                  git commit -m "Update Docs" || echo "No changes to commit"
                  git pull
                  git push || (echo "Failed to push changes" && exit 1)
            - name: Fetch gh-pages
              run: |
                  git config --global user.name "GitHub Actions"
                  git config --global user.email "actions@github.com"
                  git fetch
                  git checkout gh-pages || (echo "Failed to checkout gh-pages branch" && exit 1)
            - name: Commit and Push Resume
              run: |
                  git checkout main -- data/docs/
                  git add data/docs/
                  git commit -m "Update Docs" || echo "No changes to commit"
                  git push || (echo "Failed to push changes" && exit 1)
